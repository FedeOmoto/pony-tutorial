<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Calling C programs - Pony Tutorial</title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/highlight.css" rel="stylesheet">
  <link href="../../css/theme_extra.css" rel="stylesheet">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>
  <script src="../../js/highlight.pack.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Pony Tutorial</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
        <span>Getting started</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../..">Welcome!</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/what-you-need-to-start">What you need to start</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/installation">Installation</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/helloworld">Helloworld</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/how-it-works">How it works</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../getting-started/whitespace">Whitespace</a>
                    
                </li>
            
        

    
        
        <span>Types</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/static-vs-dynamic">Static vs dynamic</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/classes">Classes</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/primitives">Primitives</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/actors">Actors</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/traits-and-interfaces">Traits and interfaces</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/type-aliases">Type aliases</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../types/type-expressions">Type expressions</a>
                    
                </li>
            
        

    
        
        <span>Capabilities</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/introduction">Introduction</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/guarantees">Guarantees</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/aliasing">Aliasing</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/combining-capabilities">Combining capabilities</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/passing-and-sharing">Passing and sharing</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/capability-subtyping">Capability subtyping</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../capabilities/arrow-types">Arrow types</a>
                    
                </li>
            
        

    
        
        <span>Expressions</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../expressions/variables">Variables</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../expressions/infix-ops">Infix ops</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../expressions/control-structures">Control structures</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../expressions/methods">Methods</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../expressions/exceptions">Exceptions</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../expressions/sugar">Sugar</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../expressions/object-literals">Object literals</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../expressions/partial-application">Partial application</a>
                    
                </li>
            
        

    
        
        <span>Actors</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../actors/behaviours">Behaviours</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../actors/capabilities">Capabilities</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../actors/recover-and-consume">recover and consume</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../actors/arrow-types">Arrow types</a>
                    
                </li>
            
        

    
        
        <span>Packages</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../packages/package-system">Package system</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../packages/builtin">Builtin</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../packages/use-statement">Using a package</a>
                    
                </li>
            
        

    
        
        <span>Composition vs. inheritance</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../composition-inheritance/code-sharing">Code sharing</a>
                    
                </li>
            
        

    
        
        <span>Generics</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../generics/polymorphic-types">Polymorphic types</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../generics/polymorphic-methods">Polymorphic methods</a>
                    
                </li>
            
        

    
        
        <span>Pattern matching</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../pattern-matching/match">match-expression</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../pattern-matching/as">as-expression</a>
                    
                </li>
            
        

    
        
        <span>Platform</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../platform/platform">Platform</a>
                    
                </li>
            
        

    
        
        <span>Editor support</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../editor-plugins/plugins">Plugins</a>
                    
                </li>
            
        

    
        
        <span>Compiler options</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../compiler-clargs/clargs">Overview</a>
                    
                </li>
            
        

    
        
        <span>Patterns</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../patterns/patterns">Patterns</a>
                    
                </li>
            
        

    
        
        <span>Garbage collection</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../garbage-collection/garbage-collection">Garbage collection</a>
                    
                </li>
            
        

    
        
        <span>C-FFI</span>
            
                <li class="toctree-l1 current">
                    <a class="current" href=".">Calling C programs</a>
                    
                        <ul>
                        
                            <li class="toctree-l2"><a href="#calling-c">Calling C</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#using-ffi">Using FFI</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#safely-does-it">Safely does it</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#using-the-libraries">Using the libraries</a></li>
                            
                        
                        </ul>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../linking-c">Linking to C libraries</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../c-abi">Exposing a C-ABI</a>
                    
                </li>
            
        

    
        
        <span>Examples</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../examples/examples">Examples</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../.."></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    <li>Calling C programs</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <h1 id="calling-c">Calling C</h1>
<p>Pony supports integration with other native languages through the
Foreign Function Interface (FFI). The FFI library provides a stable
and portable API and high level programming interface allowing Pony
to integrate with native libraries easily.</p>
<h1 id="using-ffi">Using FFI</h1>
<p>FFI is built into pony and native libraries may be directly referenced
in the pony language. There is no need to configure binding wrappers or code generate
wrapper interfaces.</p>
<p>For example, pony itself uses FFI to provide SSL support, so lets use that
as a motivating example.</p>
<pre><code>// File: packages/net/ssl/sslinit.pony

 1 use &quot;path:/usr/local/opt/libressl/lib&quot; if osx
 2 use &quot;lib:ssl&quot; if not windows
 3 use &quot;lib:crypto&quot; if not windows
 4 use &quot;lib:libssl-32&quot; if windows
 5 use &quot;lib:libcrypto-32&quot; if windows
 6
 7 primitive _SSLInit
 8   &quot;&quot;&quot;
 9   This initialises SSL when the program begins.
10   &quot;&quot;&quot;
11   fun _init(env: Env) =&gt;
12     @SSL_load_error_strings[None]()
13     @SSL_library_init[I32]()
</code></pre>

<ul>
<li>In line 1, we provide a path to the library we wish to integrate with</li>
<li>On OS X, we use a fixed path to a brew installed fork of OpenSSL libressl</li>
<li>On line 2, we use the standard path on linux or UNIX environments</li>
<li>On line 3, we include the libcrypto dependency</li>
<li>On line 4 and 5 we include the windows 32 bit flavors</li>
</ul>
<p>If you are integrating with existing libraries, that is it.</p>
<h1 id="safely-does-it">Safely does it</h1>
<p>Pony will check the signatures used to make sure they are mapped and bound
correctly to the pony type system. In the example above, on line 13, we are calling the OpenSSL
SSL_library_init function and returning an <code>I32</code> or 32-bit signed integer.
We are not passing any arguments from pony into this function.
As this expression is the last in the function, the result of the call to SSL_library_init
will be returned to pony, and pony will return it to the caller.</p>
<p>If there are compiler issues (due to type mismatch) they will be reported.
If the library cannot be found and loaded, this will be reported.
If the function being called is not exported or found this will also be reported.</p>
<h1 id="using-the-libraries">Using the libraries</h1>
<p>In order to use the libraries we use the FFI call expression form.</p>
<pre><code>
11   fun _init(env: Env) =&gt;
12     @SSL_load_error_strings[None]()
13     @SSL_library_init[I32]()
</code></pre>

<p>In this case we are calling SSL_load_error_strings; which loads the error strings for all crypto functions, and SSL_library_init; which initializes available ciphers and digests.  at initialization (at program start).</p>

            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../linking-c" class="btn btn-neutral float-right" title="Linking to C libraries"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../garbage-collection/garbage-collection" class="btn btn-neutral" title="Garbage collection"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
      <span><a href="../../garbage-collection/garbage-collection" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../linking-c" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>